<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Meu Projeto</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>

  <div class="container mt-5">
    <h1 class="mb-4 text-primary">Minhas Finanças</h1>
        <div>
        <!-- Button trigger modal -->
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Lançar novo gasto
            </button>

        <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Adicionando novo gasto</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="nomeGasto" class="form-label">Nome do Gasto:</label>
                                        <input id= "nomeGasto" class="form-control" type="text" placeholder="Insira o nome do gasto" aria-label="Insira o nome do gasto">
                                    </div>

                                    <div class="mb-3">
                                        <label for="nomeCategoria" class="form-label">Categoria:</label>
                                        <select id="nomeCategoria" class="form-select" aria-label="Default select example">
                                          <option selected>Selecione a categoria</option>
                                          <option value="1">One</option>
                                          <option value="2">Two</option>
                                          <option value="3">Three</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="nomeValorTotal" class="form-label">Valor Total:</label>
                                        <input id= "nomeValorTotal" class="form-control" type="text" placeholder="Insira o valor total" aria-label="Insira o valor total">
                                    </div>
                                    <div class="mb-3">
                                        <label for="nomeParcelas" class="form-label">Parcelas:</label>
                                        <input id= "nomeParcelas" class="form-control" type="number" placeholder="Insira as parcelas" aria-label="Insira as parcelas">
                                    </div>
                                    <div class="mb-3">
                                        <label for="nomeValorParcela" class="form-label">Valor da Parcela:</label>
                                        <input id="nomeValorParcela" class="form-control" disabled type="text" placeholder="Calculado automaticamente" aria-label="Calculado automaticamente">
                                    </div>
                                    <div class="mb-3">
                                      <label for="nomeFormaPagamento" class="form-label">Forma de Pagamento:</label>
                                      <select id="nomeFormaPagamento" class="form-select" aria-label="Forma de pagamento">
                                        <option selected disabled>Selecione a forma de pagamento</option>
                                      </select>
                                    </div>
                                    <div class="mb-3">
                                      <label for="nomeTipoGasto" class="form-label">Tipo de Gasto:</label>
                                      <select id="nomeTipoGasto" class="form-select" aria-label="Tipo de gasto">
                                        <option selected disabled>Selecione o tipo de gasto</option>
                                      </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="nomeData" class="form-label">Data de Compra:</label>
                                        <input id= "nomeData" class="form-control" type="text" placeholder="Insira a data do gasto" aria-label="Insira a data do gasto">
                                    </div>

                                </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                <button type="button" class="btn btn-success">Adicionar</button>
                            </div>
                    </div>
                </div>
            </div>
        </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/js/main.js"></script>

  <script>
      const inputValorTotal = document.getElementById('nomeValorTotal');
      const inputParcelas = document.getElementById('nomeParcelas');
      const inputValorParcela = document.getElementById('nomeValorParcela');

      function atualizarParcela() {
        const total = parseFloat(inputValorTotal.dataset.raw || 0);
        const parcelas = parseInt(inputParcelas.value, 10);

        if (total > 0 && parcelas > 0) {
          const valor = (Math.floor((total / parcelas) * 100) / 100).toFixed(2);
          inputValorParcela.value = new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL'
          }).format(valor).replace(/\u00A0/g, ' ');
        } else {
          inputValorParcela.value = '';
        }
      }

      // Máscara do campo Valor Total
      inputValorTotal.addEventListener('input', function () {
        let onlyDigits = this.value.replace(/\D/g, '');
        if (!onlyDigits) {
          this.value = '';
          atualizarParcela();
          return;
        }

        const number = (parseInt(onlyDigits, 10) / 100).toFixed(2);
        let formatted = new Intl.NumberFormat('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        }).format(number);

        this.value = formatted.replace(/\u00A0/g, ' ');
        this.dataset.raw = number; // guarda valor sem formatação

        atualizarParcela();
      });

      // Atualiza parcelas em tempo real
      inputParcelas.addEventListener('input', atualizarParcela);
  </script>

  <script>
      async function carregarFormasPagamento() {
        const select = document.getElementById("nomeFormaPagamento");

        try {
          const response = await fetch("/enum/formas-pagamento"); // rota do FastAPI
          const formas = await response.json();

          formas.forEach(f => {
            const option = document.createElement("option");
            option.value = f.key;   // ex: "credito"
            option.textContent = f.value; // ex: "crédito"
            select.appendChild(option);
          });
        } catch (error) {
          console.error("Erro ao carregar formas de pagamento:", error);
        }
      }

      carregarFormasPagamento();
  </script>

  <script>
      async function carregarTiposGasto() {
        const select = document.getElementById("nomeTipoGasto");

        try {
          const response = await fetch("/enum/tipos-gasto"); // rota do FastAPI
          const formas = await response.json();

          formas.forEach(f => {
            const option = document.createElement("option");
            option.value = f.key;
            option.textContent = f.value;
            select.appendChild(option);
          });
        } catch (error) {
          console.error("Erro ao carregar tipos de gasto:", error);
        }
      }

      carregarTiposGasto();
  </script>

  <script>
      const inputData = document.getElementById("nomeData");

      inputData.addEventListener("input", function(e) {
        let valor = e.target.value.replace(/\D/g, ""); // só números

        if (valor.length > 2) {
          valor = valor.slice(0,2) + "/" + valor.slice(2);
        }
        if (valor.length > 5) {
          valor = valor.slice(0,5) + "/" + valor.slice(5,9);
        }

        e.target.value = valor;
      });
  </script>

</body>
</html>
